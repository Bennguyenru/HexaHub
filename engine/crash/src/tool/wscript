import sys
import Task, TaskGen
from TaskGen import extension, declare_extension
from waf_dynamo import new_copy_task

new_copy_task('luascript', '.lua', '.luac')

def build(bld):
    libs = 'SCRIPT EXTENSION THREAD RESOURCE DDF DLIB LUA SCRIPT'

    if sys.platform in ('darwin', 'win32', 'linux2'):
	    crashtool = bld.new_task_gen(features = 'cxx cprogram',
	                                     includes = '..',
	                                     uselib = libs,
	                                     uselib_local = 'crashext',
	                                     target = 'crashtool',
	                                     source = '../crash.cpp crashtool.cpp')

	    if sys.platform == 'win32':
			crashtool.env.append_value('LINKFLAGS', ['Dbghelp.lib', 'psapi.lib'])
